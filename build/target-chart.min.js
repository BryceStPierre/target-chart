"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),TargetChart=function(){function t(){_classCallCheck(this,t),arguments.length<1?console.error("TargetChart: Incorrect arguments."):1===arguments.length?(this._e=arguments.length<=0?void 0:arguments[0],this.options({})):arguments.length>1&&(this._e=arguments.length<=0?void 0:arguments[0],this.options(arguments.length<=1?void 0:arguments[1]))}return _createClass(t,[{key:"options",value:function(t){this._o={barHeight:t.barHeight||20,bgColor:t.bgColor||"none",height:t.height||350,highColor:t.highColor||"#FF4C3B",font:t.font||"sans-serif",fontSize:t.fontSize||12,lowColor:t.lowColor||"#0072BB",showLabels:void 0===t.showLabels||t.showLabels,textColor:t.textColor||"#111111",title:t.title||null,width:this._e.clientWidth>=320?this._e.clientWidth:320}}},{key:"data",value:function(t){this._d=t,this._m={label:5,value:5,title:this._o.title?4.5*this._o.barHeight:3*this._o.barHeight,bar:3*this._o.barHeight/4},this._o.title||this._o.showLabels||(this._m.title=2*this._o.barHeight),this._o.height=this._m.title+this._d.length*(this._o.barHeight+this._m.bar)}},{key:"reset",value:function(){this._e.innerHTML="",this.options(this._o)}},{key:"render",value:function(){this.reset();var t=this._o.width,e=this._o.height,i=d3.select("#"+this._e.id).append("svg").attr("width",t).attr("height",e).style("font-family",this._o.font).style("font-size",this._o.fontSize+"px");if(i.append("rect").attr("width",t).attr("height",e).style("fill",this._o.bgColor),this._d&&this._m){var o=this.textSize(i,this._d.map(function(t){return t.label})),r=this.textSize(i,this._d.map(function(t){return t.value.toString()})),a=2*this._m.label+o.w,l=2*this._m.value+r.w,h=this._o.barHeight,s=t-(2*a+2*l)-2*h;this._o.title&&i.append("text").attr("text-anchor","middle").attr("x",t/2).attr("y",this._m.title-10*h/3).style("font-size","16px").style("fill",this._o.textColor).text(this._o.title),i.append("line").attr("x1",t/2).attr("y1",this._m.title-this._m.bar).attr("x2",t/2).attr("y2",e-this._m.bar).style("stroke","#EEE").style("stroke-width","3px"),i.append("text").attr("text-anchor","middle").attr("x",a+l+h).attr("y",this._m.title-3*h/4).style("fill",this._o.textColor).text("-1 STD"),i.append("text").attr("text-anchor","middle").attr("x",a+l+h+s).attr("y",this._m.title-3*h/4).style("fill",this._o.textColor).text("+1 STD"),this._o.showLabels&&(i.append("text").attr("text-anchor","middle").attr("x",a+l+h).attr("y",this._m.title-2*h).style("fill",this._o.lowColor).style("font-size","14px").text("BELOW"),i.append("text").attr("text-anchor","middle").attr("x",t/2).attr("y",this._m.title-2*h).style("fill",this._o.textColor).style("font-size","14px").text("TARGET"),i.append("text").attr("text-anchor","middle").attr("x",a+l+h+s).attr("y",this._m.title-2*h).style("fill",this._o.highColor).style("font-size","14px").text("ABOVE"));for(var n=this._d.length,_=this._m.title,x=0;x<n;_+=h+this._m.bar,x++){var d=this._d[x],p=d.value<d.target,f=Math.abs(d.target-d.value)/d.std,c=(f=f>1?1:f)*(s/2),u=p?t/2-c:t/2;i.append("rect").attr("x",a+l+h).attr("y",_).attr("width",s).attr("height",h).style("fill","#EEE"),i.append("rect").attr("x",t/2).attr("y",_).attr("width",0).attr("height",h).style("fill",p?this._o.lowColor:this._o.highColor).transition().duration(1500).attr("x",u).attr("width",c),i.append("circle").attr("cx",t/2).attr("cy",_+h/2).attr("r",h/2+this._o.fontSize/2).style("fill","#FFF").style("stroke",p?this._o.lowColor:this._o.highColor).style("stroke-width","1px").transition().duration(1500).attr("cx",p?u:t/2+c),i.append("text").attr("text-anchor","middle").attr("x",a/2).attr("y",_+h/2+(this._o.fontSize-2)/2).attr("fill",this._o.textColor).text(d.label),i.append("text").attr("text-anchor","middle").attr("x",t-a/2).attr("y",_+h/2+(this._o.fontSize-2)/2).attr("fill",this._o.textColor).text(d.label),i.append("text").attr("text-anchor","middle").attr("x",p?a+l/2:t-a-l/2).attr("y",_+h/2+(this._o.fontSize-2)/2).attr("fill",this._o.textColor).text(d.value)}}else i.append("text").attr("text-anchor","middle").attr("x",t/2).attr("y",e/2+this._o.fontSize).style("fill",this._o.textColor).text("No data.")}},{key:"textSize",value:function(t,e){var i=e.map(function(e){var i=t.append("text").text(e),o=i.node().getBBox();return i.remove(),{w:o.width,h:o.height}});return{w:Math.max.apply(null,i.map(function(t){return t.w})),h:Math.max.apply(null,i.map(function(t){return t.h}))}}}]),t}();